<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Risemedia Tech Bid Adapter Test</title>
  <script src="../../../build/dev/prebid.js"></script>
  <script>
    var pbjs = pbjs || {};
    pbjs.que = pbjs.que || [];
  </script>
  <style>
    .ad-container {
      margin: 15px 0;
    }
  </style>
</head>
<body>
  <h2>Testing: RisemediatechBidAdapter</h2>

  <!-- Static Banner (Loaded on Page Load) -->
  <div class="ad-container">
    <strong>Static Banner Ad:</strong>
    <div id="static-banner" style="width:300px;height:250px;border:1px solid #000;"></div>
  </div>

  <!-- On-Demand Buttons -->
  <div class="ad-container">
    <strong>On-Demand Controls:</strong><br>
    <button onclick="loadAdUnits(['dynamic-banner', 'dynamic-video'])">Get All Ads</button>
    <button onclick="loadAdUnits(['dynamic-banner'])">Get Banner Ad</button>
    <button onclick="loadAdUnits(['dynamic-video'])">Get Video Ad</button>
    <button onclick="loadAdUnits(['test-banner-div'])">Get Test Banner</button>
    <button onclick="loadAdUnits(['test-video-div'])">Get Test Video</button>
  </div>

  <!-- Dynamic Banner Ad -->
  <div class="ad-container">
    <strong>Dynamic Banner Ad:</strong>
    <div id="dynamic-banner" style="width:300px;height:250px;border:1px solid #000;"></div>
  </div>

  <!-- Dynamic Video Ad -->
  <div class="ad-container">
    <strong>Dynamic Video Ad:</strong><br>
    <video id="dynamic-video-player" width="640" height="360" controls style="display:none;"></video>
  </div>

  <!-- Test Banner Ad -->
  <div class="ad-container">
    <strong>Test Banner Ad:</strong>
    <div id="test-banner-div" style="width:320px;height:50px;border:1px solid #000;"></div>
  </div>

  <!-- Test Video Ad -->
  <div class="ad-container">
    <strong>Test Video Ad:</strong><br>
    <video id="test-video-player" width="640" height="480" controls style="display:none;"></video>
  </div>

  <script>
    const PUBLISHER_ID = '12345';
    const PLACEMENT_ID = '67890';
    const BID_FLOOR = 0.01;

    pbjs.que.push(function () {
      pbjs.setConfig({ debug: true, cache: { useLocal: true } });

      const staticBannerAdUnit = {
        code: 'static-banner',
        mediaTypes: {
          banner: {
            sizes: [[320, 50]]
          }
        },
        bids: [{
          bidder: 'risemediatech',
          params: {
            publisherId: PUBLISHER_ID,
            placementId: PLACEMENT_ID,
            bidfloor: BID_FLOOR,
            mimes: ['image/jpeg', 'image/png']
          }
        }]
      };

      pbjs.addAdUnits(staticBannerAdUnit);

      pbjs.requestBids({
        bidsBackHandler: function () {
          const bid = pbjs.getHighestCpmBids('static-banner')[0];
          if (bid?.ad) {
            document.getElementById('static-banner').innerHTML = bid.ad;
          }
        }
      });
    });

    function getAdUnit(code) {
      if (code === 'dynamic-banner') {
        return {
          code,
          mediaTypes: {
            banner: { sizes: [[320, 50]] }
          },
          bids: [{
            bidder: 'risemediatech',
            params: {
              publisherId: PUBLISHER_ID,
              placementId: PLACEMENT_ID,
              bidfloor: BID_FLOOR
            }
          }]
        };
      } else if (code === 'dynamic-video') {
        return {
          code,
          mediaTypes: {
            video: {
              playerSize: [640, 360],
              mimes: ['video/mp4'],
              protocols: [2, 3, 5],
              minduration: 1,
              maxduration: 30,
              startdelay: 0,
              maxseq: 1,
              poddur: 45
            }
          },
          bids: [{
            bidder: 'risemediatech',
            params: {
              publisherId: PUBLISHER_ID,
              placementId: PLACEMENT_ID,
              bidfloor: BID_FLOOR
            }
          }]
        };
      } else if (code === 'test-banner-div') {
        return {
          code,
          mediaTypes: {
            banner: {
              sizes: [[320, 50]]
            }
          },
          bids: [{
            bidder: 'risemediatech',
            params: {
              bidfloor: 0.001,
              testMode: 1
            }
          }]
        };
      } else if (code === 'test-video-div') {
        return {
          code,
          mediaTypes: {
            video: {
              playerSize: [640, 480],
              context: 'instream',
              mimes: ['video/mp4', 'video/webm'],
              minduration: 5,
              maxduration: 30,
              startdelay: 30,
              maxseq: 2,
              poddur: 30,
              protocols: [1, 3, 4]
            }
          },
          bids: [{
            bidder: 'risemediatech',
            params: {
              bidfloor: 0.001,
              testMode: 1
            }
          }]
        };
      }
      return null;
    }

    function loadAdUnits(unitCodes = []) {
      // Clear previous banner content
      ['dynamic-banner', 'test-banner-div'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.innerHTML = '';
      });

      // Clear and hide video players
      const dynamicVideo = document.getElementById('dynamic-video-player');
      dynamicVideo.pause(); dynamicVideo.src = ''; dynamicVideo.style.display = 'none';

      const testVideo = document.getElementById('test-video-player');
      testVideo.pause(); testVideo.src = ''; testVideo.style.display = 'none';

      const adUnits = unitCodes.map(getAdUnit).filter(Boolean);

      pbjs.que.push(function () {
        unitCodes.forEach(code => pbjs.removeAdUnit(code));
        pbjs.addAdUnits(adUnits);

        pbjs.requestBids({
          adUnitCodes: unitCodes,
          bidsBackHandler: function () {
            unitCodes.forEach(code => {
              const bid = pbjs.getHighestCpmBids(code)[0];

              if ((code === 'dynamic-banner' || code === 'test-banner-div') && bid?.ad) {
                document.getElementById(code).innerHTML = bid.ad;
              }

              if (code === 'dynamic-video' && bid?.vastUrl) {
                dynamicVideo.src = bid.vastUrl;
                dynamicVideo.style.display = 'block';
                dynamicVideo.load();
                dynamicVideo.play();
              }

              if (code === 'test-video-div' && bid?.vastUrl) {
                testVideo.src = bid.vastUrl;
                testVideo.style.display = 'block';
                testVideo.load();
                testVideo.play();
              }
            });
          }
        });
      });
    }
  </script>
</body>
</html>
